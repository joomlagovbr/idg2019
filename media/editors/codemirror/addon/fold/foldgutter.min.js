!(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],a):a(CodeMirror)})((function(a){"use strict";function b(a){this.options=a,this.from=this.to=0}function c(a){return!0===a&&(a={}),null==a.gutter&&(a.gutter="CodeMirror-foldgutter"),null==a.indicatorOpen&&(a.indicatorOpen="CodeMirror-foldgutter-open"),null==a.indicatorFolded&&(a.indicatorFolded="CodeMirror-foldgutter-folded"),a}function d(a,b){for(var c=a.findMarks(m(b,0),m(b+1,0)),d=0;d<c.length;++d)if(c[d].__isFold){var e=c[d].find(-1);if(e&&e.line===b)return c[d]}}function e(a){if("string"==typeof a){var b=document.createElement("div");return b.className=a+" CodeMirror-guttermarker-subtle",b}return a.cloneNode(!0)}function f(a,b,c){var f=a.state.foldGutter.options,h=b-1,i=a.foldOption(f,"minFoldSize"),j=a.foldOption(f,"rangeFinder"),k="string"==typeof f.indicatorFolded&&g(f.indicatorFolded),l="string"==typeof f.indicatorOpen&&g(f.indicatorOpen);a.eachLine(b,c,(function(b){++h;var c=null,g=b.gutterMarkers;if(g&&(g=g[f.gutter]),d(a,h)){if(k&&g&&k.test(g.className))return;c=e(f.indicatorFolded)}else{var n=m(h,0),o=j&&j(a,n);if(o&&o.to.line-o.from.line>=i){if(l&&g&&l.test(g.className))return;c=e(f.indicatorOpen)}}(c||g)&&a.setGutterMarker(b,f.gutter,c)}))}function g(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function h(a){var b=a.getViewport(),c=a.state.foldGutter;c&&(a.operation((function(){f(a,b.from,b.to)})),c.from=b.from,c.to=b.to)}function i(a,b,c){var e=a.state.foldGutter;if(e){var f=e.options;if(c==f.gutter){var g=d(a,b);g?g.clear():a.foldCode(m(b,0),f)}}}function j(a){var b=a.state.foldGutter;if(b){var c=b.options;b.from=b.to=0,clearTimeout(b.changeUpdate),b.changeUpdate=setTimeout((function(){h(a)}),c.foldOnChangeTimeSpan||600)}}function k(a){var b=a.state.foldGutter;if(b){var c=b.options;clearTimeout(b.changeUpdate),b.changeUpdate=setTimeout((function(){var c=a.getViewport();b.from==b.to||c.from-b.to>20||b.from-c.to>20?h(a):a.operation((function(){c.from<b.from&&(f(a,c.from,b.from),b.from=c.from),c.to>b.to&&(f(a,b.to,c.to),b.to=c.to)}))}),c.updateViewportTimeSpan||400)}}function l(a,b){var c=a.state.foldGutter;if(c){var d=b.line;d>=c.from&&d<c.to&&f(a,d,d+1)}}a.defineOption("foldGutter",!1,(function(d,e,f){f&&f!=a.Init&&(d.clearGutter(d.state.foldGutter.options.gutter),d.state.foldGutter=null,d.off("gutterClick",i),d.off("changes",j),d.off("viewportChange",k),d.off("fold",l),d.off("unfold",l),d.off("swapDoc",j)),e&&(d.state.foldGutter=new b(c(e)),h(d),d.on("gutterClick",i),d.on("changes",j),d.on("viewportChange",k),d.on("fold",l),d.on("unfold",l),d.on("swapDoc",j))}));var m=a.Pos}));